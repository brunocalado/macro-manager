<div class="mm-builder-wrapper">
    
    {{!-- HEADER: Tabs Only --}}
    <div class="mm-builder-header">
        <nav class="mm-tabs-nav">
            <a class="mm-tab-link active" data-tab="selection"><i class="fas fa-list"></i> Selection</a>
            <a class="mm-tab-link" data-tab="configuration"><i class="fas fa-cogs"></i> Configuration</a>
        </nav>
    </div>

    {{!-- CONTENT: Selection Tab --}}
    <div class="mm-tab-content active" data-tab="selection">
        
        {{!-- Target Mode Selection (Moved inside Selection Tab) --}}
        <div class="mm-selection-header">
            <div class="mm-options-group">
                <span class="mm-label-title">Target Mode:</span>
                <label class="mm-radio-label">
                    <input type="radio" name="targetMode" value="world" data-action="switchMode" {{#if isWorldMode}}checked{{/if}}> World
                </label>
                <label class="mm-radio-label">
                    <input type="radio" name="targetMode" value="compendium" data-action="switchMode" {{#if isCompendiumMode}}checked{{/if}}> Compendium
                </label>
            </div>
        </div>

        <div class="mm-builder-container">
            {{!-- Left Column: Sources --}}
            <div class="mm-builder-column">
                <h3>Available Sources</h3>
                <div class="mm-scroll-list">
                    {{#if isWorldMode}}
                        <p class="mm-help-text" style="margin-top: 10px;">Listing all World Macros.</p>
                    {{else}}
                        {{#each packs}}
                        <label class="mm-checkbox-row mm-source-row" data-type="{{this.type}}">
                            <input type="checkbox" name="packIds" value="{{this.id}}" {{#if this.checked}}checked{{/if}} data-action="togglePack">
                            <span>{{this.label}}</span>
                        </label>
                        {{/each}}
                    {{/if}}
                </div>
            </div>

            {{!-- Right Column: Macros --}}
            <div class="mm-builder-column">
                <h3>Select Macros</h3>
                <div class="mm-scroll-list">
                    {{#if macros.length}}
                        <div class="mm-tools">
                            <button type="button" data-action="selectAll" class="mm-small-btn">All</button>
                            <button type="button" data-action="deselectAll" class="mm-small-btn">None</button>
                        </div>
                        {{#each macros}}
                        <label class="mm-checkbox-row">
                            <div class="mm-checkbox-wrap">
                                <input type="checkbox" name="macroData" value="{{this.uuid}}">
                            </div>
                            <img src="{{this.img}}" width="24" height="24"/>
                            <span class="mm-macro-name">{{this.name}}</span>
                            
                            <button type="button" class="mm-icon-btn" data-action="previewMacro" data-uuid="{{this.uuid}}" title="Preview Macro">
                                <i class="fas fa-eye"></i>
                            </button>
                            
                            <span class="mm-pack-tag">{{this.packLabel}}</span>
                        </label>
                        {{/each}}
                    {{else}}
                        <p class="mm-help-text">Select a source on the left to view macros.</p>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>

    {{!-- CONTENT: Configuration Tab --}}
    <div class="mm-tab-content" data-tab="configuration">
        <div class="mm-config-container">
            <h3>Macro Settings</h3>
            <p class="mm-help-text">These settings will be embedded into the created macro.</p>
            
            <div class="mm-form-group">
                <label>Persistent Window</label>
                <div class="mm-input-wrap">
                     <input type="checkbox" name="confPersistent" checked>
                     <p class="hint">If checked, the Macro Manager window stays open after clicking a macro.</p>
                </div>
            </div>

            <div class="mm-form-group">
                <label>Window Width (px)</label>
                <div class="mm-input-wrap">
                    <input type="number" name="confWidth" value="400">
                </div>
            </div>

            <div class="mm-form-group">
                <label>Font Size (px)</label>
                <div class="mm-input-wrap">
                    <input type="number" name="confFontSize" value="16">
                </div>
            </div>

            <div class="mm-form-group">
                <label>Sort Macros Alphabetically</label>
                <div class="mm-input-wrap">
                    <input type="checkbox" name="confSort" checked>
                </div>
            </div>
        </div>
    </div>

    {{!-- FOOTER --}}
    <div class="mm-footer">
        <div class="mm-input-group">
            <label>Name:</label>
            <input type="text" name="macroName" value="My Custom Manager" required>
        </div>
        <button type="submit" class="mm-save-btn">
            <i class="fas fa-hammer"></i> Build
        </button>
    </div>
</div>